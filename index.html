<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>쿼카와 함께하는 Cypher 게임</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" id="vite-entry" src="/src/main.jsx"></script>
    <script>
      const entryScript = document.getElementById('vite-entry');
      const isLocalDev = ['localhost', '127.0.0.1', '[::1]'].includes(location.hostname);
      const deriveBaseFromPath = () => {
        const pathSegments = location.pathname.split('/').filter(Boolean);
        return pathSegments.length > 0 ? `/${pathSegments[0]}/` : '/';
      };
      const base = window.__APP_BASE__ || deriveBaseFromPath();

      const loadProdBundle = () => {
        if (!document.querySelector(`link[href="${base}assets/app.css"]`)) {
          const cssLink = document.createElement('link');
          cssLink.rel = 'stylesheet';
          cssLink.href = `${base}assets/app.css`;
          document.head.appendChild(cssLink);
        }

        const prodScript = document.createElement('script');
        prodScript.type = 'module';
        prodScript.src = `${base}assets/app.js`;
        document.body.appendChild(prodScript);
      };

      if (!isLocalDev && entryScript) {
        entryScript.addEventListener('error', loadProdBundle, { once: true });
      }

      window.addEventListener(
        'error',
        (event) => {
          const target = event?.target;
          if (target?.tagName === 'SCRIPT' && target.src && target.src.includes('/src/main.jsx')) {
            loadProdBundle();
          }
        },
        { once: true }
      );
    </script>
  </body>
</html>
