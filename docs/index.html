<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>쿼카와 함께하는 Cypher 게임</title>
    <script type="module" crossorigin src="./assets/app.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/app.css">
  </head>
  <body>
    <div id="root"></div>
    <script>
      const entryScript = document.getElementById('vite-entry');
      const isLocalDev = ['localhost', '127.0.0.1', '[::1]'].includes(location.hostname);
      const repoBase = window.__APP_BASE__ || (location.pathname.includes('/neo4j-cyper-game/') ? '/neo4j-cyper-game/' : '/');
      const currentDirBase = location.pathname.replace(/[^/]*$/, '');

      // GitHub Pages에서 "루트" 경로로 서비스될 때(=docs/가 URL에 없을 때) 번들 파일은
      // docs/assets 아래에 존재합니다. 기본 경로와 docs 하위 경로를 순차적으로 시도해
      // 어느 환경에서나 404 없이 불러올 수 있게 합니다.
      const assetBases = currentDirBase.includes('/docs/')
        ? [currentDirBase]
        : [repoBase, `${repoBase.replace(/\/?$/, '/') || '/'}docs/`];

      const loadProdBundle = (index = 0) => {
        const base = assetBases[index];
        if (!base) return;

        const cssLink = document.createElement('link');
        cssLink.rel = 'stylesheet';
        cssLink.href = `${base}assets/app.css`;
        cssLink.onerror = () => loadProdBundle(index + 1);

        const prodScript = document.createElement('script');
        prodScript.type = 'module';
        prodScript.src = `${base}assets/app.js`;
        prodScript.onerror = () => loadProdBundle(index + 1);

        document.head.appendChild(cssLink);
        document.body.appendChild(prodScript);
      };

      if (!isLocalDev && entryScript) {
        entryScript.addEventListener('error', () => loadProdBundle(), { once: true });
      }

      window.addEventListener(
        'error',
        (event) => {
          const target = event?.target;
          if (target?.tagName === 'SCRIPT' && target.src && target.src.includes('/src/main.jsx')) {
            loadProdBundle();
          }
        },
        { once: true }
      );
    </script>
  </body>
</html>
